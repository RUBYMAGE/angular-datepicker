/*!
 * RM-DATEPICKER v1.0.0
 * http://rubymage.com
 *
 * Copyright 2015 Sergiu Ghenciu, RUBYMAGE
 * Released under the MIT license
 * https://github.com/RUBYMAGE/angular-datepicker/blob/master/LICENSE
 */
!function(){var e=angular.module("rmDatepicker",[]);e.constant("rmDatepickerConfig",{mondayStart:!1,textToday:"Today",initState:"month",maxState:"decade",minState:"month",toggleState:!0,decadeSize:12,monthSize:42,min:null,max:null,"default":new Date,activeMonthFormat:"MMMM yyyy",format:"yyyy-MM-dd"}),e.directive("rmDatepicker",["rmDatepickerConfig","$compile","$filter","$document","$timeout",function(e,t,a,n,i){var r=function(r,s,c,l){var d=angular.copy(e);if(r.rmConfig)for(var f in d)d.hasOwnProperty(f)&&void 0!=r.rmConfig[f]&&(d[f]=r.rmConfig[f]);d.min&&d.min.setHours(0,0,0,0),d.max&&d.max.setHours(23,59,59,999),d.min&&d["default"]<d.min&&(d["default"]=new Date(d.min.getTime())),d.max&&d["default"]>d.max&&(d["default"]=new Date(d.max.getTime())),d["default"].setHours(0,0,0,0);var u=function(){return new Date(d["default"].getTime())},m="INPUT"==s[0].tagName.toUpperCase(),g={min:!1,max:!1},v=function(e,t){return new Date(e,t+1,0).getDate()},D=function(e){var e=parseInt(e,10);if(!isNaN(e)){var t=v(r.j.getFullYear(),r.j.getMonth());e<1&&(e=1),e>t&&(e=t),r.j.setDate(e)}},p={decade:function(e){var t,a=e.getFullYear(),n=e.getMonth(),i=e.getDate(),r=0,o=d.decadeSize||12,s=new Array(o);for(a=Math.floor(a/o)*o;r<o;a++,r++)t=v(a,n),i>t&&(i=t),s[r]=new Date(a,n,i,3,0,1,0);return s},year:function(e){for(var t,a=e.getFullYear(),n=0,i=e.getDate(),r=[];n<12;n++)t=v(a,n),i>t&&(i=t),r.push(new Date(a,n,i,3,0,1,0));return r},month:function(e){var t,a=e.getFullYear(),n=e.getMonth(),i=new Date(a,n,1,3,0,1,0),o=i.getDay()||7;return r.mondayStart&&(o=o-1||7),t="auto"==d.monthSize?o+v(a,n)<35?35:42:d.monthSize,i.setDate(-o+1),p.dates(i,t)},dates:function(e,t){for(var a=new Array(t),n=new Date(e),i=0;i<t;)a[i++]=new Date(n),n.setDate(n.getDate()+1);return a}},y=function(e){if(e=e||r.state,r.aDates=p[e](r.j),d.min&&(g.min=r.aDates[0]<d.min),d.max){var t=r.aDates[r.aDates.length-1];g.max=t>d.max}},h=!1,w=function(){return r.j&&r.j instanceof Date||(h=!0,r.j=u()),y()},x=function(e,t){return"decade"==r.state?e.getFullYear()<t.getFullYear():"year"==r.state?e.getFullYear()==t.getFullYear()?e.getMonth()<t.getMonth():e.getFullYear()<t.getFullYear():e<t};r.isOff=function(e){return!(!d.min&&!d.max)&&(!(!d.min||!x(e,d.min))||(!(!d.max||!x(d.max,e))||void 0))},r.isActive={year:function(e){return e.getFullYear()==r.j.getFullYear()},month:function(e){return e.getMonth()==r.j.getMonth()},date:function(e){return e.getDate()==r.j.getDate()}},r.isToday=function(e){return r.isActive.date(e)&&r.isActive.month(e)&&r.isActive.year(e)},r.go=function(e){if(!r.isOff(e)){m&&r.state==d.minState&&r.isActive.month(e)&&k(!1);var t=r.j.getMonth();r.j=new Date(e),h=!1,i(function(){l.$setViewValue(r.j)}),d.toggleState&&r.toggleState(1),t!=r.j.getMonth()&&y()}},r.now=function(){r.j=new Date,y()},r.next=function(e){if(e=e||1,e>0){if(g.max)return}else if(g.min)return;var t=r.j.getFullYear(),a=r.j.getMonth(),n=r.j.getDate();switch(r.state){case"decade":e*=r.aDates.length;case"year":r.j.setFullYear(t+e,a,15),D(n);break;case"month":r.j.setMonth(a+e,15),D(n);break;case"week":r.j.setDate(n+7*e)}y()},r.prev=function(e){return r.next(-e||-1)},r.toggleState=function(e){e=e||1,r.state==d.maxState&&e==-1||r.state==d.minState&&1==e||(r.state=r.aStates[r.aStates.indexOf(r.state)+e],y())},r.mondayStart=d.mondayStart,r.textToday=d.textToday,r.aStates=["decade","year","month"],r.state=d.initState,r.activeDateTpl={decade:"{{aDates[0].getFullYear()}} - {{aDates[aDates.length-1].getFullYear()}}",year:"{{j.getFullYear()}}",month:"{{j | date: '"+d.activeMonthFormat.replace("'","")+"'}}",week:"{{ j | date: 'd MMMM yyyy' }}"},w();var j=function(e){var t=0,a=0;if(e.offsetParent)do t+=e.offsetLeft,a+=e.offsetTop;while(e=e.offsetParent);return{top:a,left:t}},k=function(e){S.css("display",e?"block":"none"),F.css("display",e?"block":"none")},M=function(e,t){var a=window.scrollX,n=window.scrollY,i=window.innerWidth,r=window.innerHeight;if(window.innerWidth<481)return{top:n,left:0};var o=n+r-e.top-t.clientHeight,s=a+i-e.left-t.clientWidth;return o<0&&(e.top+=o),e.top<n&&(e.top=n),s<0&&(e.left+=s),e.left<0&&(e.left=0),e};if(m){l.$parsers.push(function(e){return e&&(value=new Date(e))&&"Invalid Date"!=value.toString()?value:u()}),l.$formatters.push(function(e){return h?"":a("date")(e,d.format)}),l.$validators.required=function(){return!c.required||!h},l.$validators.range=function(){var e=d.min&&g.min||d.max&&g.max;return!e};var S=angular.element('<div class="rm-overlay" style="display:none"></div>');S.on("click",function(){k(!1)}),n.find("body").eq(0).append(S),S.after(t(o)(r));var F=S.next();F.css({display:"none"}),F.addClass("it-is-input"),s.on("click",function(){window.innerWidth<481&&s[0].blur();var e=j(s[0]);e.top+=s[0].offsetHeight+1,F.css({top:e.top+"px",left:e.left+"px",display:"block"}),k(!0),e=M(e,F[0]),F.css({top:e.top+"px",left:e.left+"px"})}),n.on("keydown",function(e){[9,13,27].indexOf(e.keyCode)>=0&&k(!1)})}else s.append(t(o)(r))},o='<div class="rm-datepicker" ng-class="{mondayStart: mondayStart}"><div class="nav"><a ng-hide="state == \'decade\'"><i class="mi_arrow_back"></i></a><a class="back waves-effect" ng-click="toggleState(-1)" rm-include="activeDateTpl[state]"></a><a class="adjacent waves-effect" ng-click="prev()"><i class="mi_keyboard_arrow_up"></i></a><a class="adjacent waves-effect" ng-click="next()"><i class="mi_keyboard_arrow_down"></i></a><a class="today waves-effect" ng-click="now()">{{textToday}}</a></div><div class="body" ng-include="\'rm-\' + state + \'.html\'"></div></div>';return{require:"ngModel",scope:{j:"=ngModel",rmConfig:"=rmConfig"},link:r}}]),e.run(["$templateCache",function(e){e.put("rm-decade.html",'<div class="ng-class: state; square date"><div ng-repeat="oDate in aDates" ng-class="{j: isActive[\'year\'](oDate), off: isOff(oDate)}"><a ng-click="go(oDate)" class="waves-effect"><span>{{oDate | date: \'yyyy\'}}</span></a></div></div>'),e.put("rm-year.html",'<div class="ng-class: state; square date"><div ng-repeat="oDate in aDates" ng-class="{j: isActive[\'month\'](oDate), off: isOff(oDate)}"><a ng-click="go(oDate)" class="waves-effect"><span>{{oDate | date: \'MMM\'}}</span></a></div></div>'),e.put("rm-month.html",'<div class="day sunSat"><a ng-repeat="oDate in aDates | limitTo:7">{{oDate | date: \'EEE\'}}</a></div><div class="ng-class: state; square date"><div ng-repeat="oDate in aDates" ng-class="{j: isActive[\'date\'](oDate), off: isOff(oDate), out: !isActive[\'month\'](oDate)}"><a ng-click="go(oDate)" class="waves-effect"><span>{{oDate.getDate()}}</span></a></div></div>')}]),e.directive("rmInclude",["$compile",function(e){var t=function(t,a,n){t.$watch(function(e){return e.$eval(n.rmInclude)},function(n){a.html(n),e(a.contents())(t)})};return{restrict:"A",link:t}}])}();