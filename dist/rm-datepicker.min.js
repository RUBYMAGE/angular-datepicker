/*!
 * RM-DATEPICKER v1.0.0
 * http://rubymage.com
 *
 * Copyright 2015 Sergiu Ghenciu, RUBYMAGE
 * Released under the MIT license
 * https://github.com/RUBYMAGE/angular-datepicker/blob/master/LICENSE
 */
!function(){var t=angular.module("rmDatepicker",[]);t.constant("rmDatepickerConfig",{mondayStart:!1,textToday:"Today",initState:"month",maxState:"decade",minState:"month",toggleState:!0,decadeSize:12,monthSize:42,min:null,max:null,"default":new Date,activeMonthFormat:"LLLL yyyy",format:"yyyy-MM-dd"}),t.directive("rmDatepicker",["rmDatepickerConfig","$compile","$filter","$document","$timeout",function(t,e,a,i,r){var o=function(o,l,c,u){var f=angular.copy(t),d=function(){var t=new Date(f["default"].getTime());return t.isDefault=!0,t};o.isDefault=!0;var m=d(),g=function(t){return t.isDefault?o.isDefault=!0:o.val=t,m=t},v=function(){return o.isDefault};o.getDate=function(){return m};var D=function(t){if(t){for(var e in f)f.hasOwnProperty(e)&&void 0!=t[e]&&(f[e]=t[e]);f.min&&f.min.setHours(0,0,0,0),f.max&&f.max.setHours(23,59,59,999),f.min&&f["default"]<f.min&&(f["default"]=new Date(f.min.getTime())),f.max&&f["default"]>f.max&&(f["default"]=new Date(f.max.getTime())),f["default"].setHours(3,0,1,0),v()&&g(d()),p&&(u.$viewValue=m,u.$validate(),u.$invalid&&(o.isDefault=!0,u.$viewValue=g(d()),o.state=f.initState,u.$validate())),S&&S()}};o.$watch("rmConfig",D,!0),D(o.rmConfig);var p="INPUT"==l[0].tagName.toUpperCase(),y={min:!1,max:!1},h=function(t,e){return new Date(t,e+1,0).getDate()},w=function(t){var t=parseInt(t,10);if(!isNaN(m)){var e=h(m.getFullYear(),m.getMonth());t<1&&(t=1),t>e&&(t=e),m.setDate(t)}},x={decade:function(t){var e,a=t.getFullYear(),i=t.getMonth(),r=t.getDate(),o=0,s=f.min?f.min.getFullYear():0;n=f.decadeSize||12;var l=new Array(n);for(a=Math.floor((a-s)/n)*n+s;o<n;a++,o++)e=h(a,i),r>e&&(r=e),l[o]=new Date(a,i,r,3,0,1,0);return l},year:function(t){for(var e,a=t.getFullYear(),n=0,i=t.getDate(),r=[];n<12;n++)e=h(a,n),i>e&&(i=e),r.push(new Date(a,n,i,3,0,1,0));return r},month:function(t){var e,a=t.getFullYear(),n=t.getMonth(),i=new Date(a,n,1,3,0,1,0),r=i.getDay()||7;return o.mondayStart&&(r=r-1||7),e="auto"==f.monthSize?r+h(a,n)<35?35:42:f.monthSize,i.setDate(-r+1),x.dates(i,e)},dates:function(t,e){for(var a=new Array(e),n=new Date(t),i=0;i<e;)a[i++]=new Date(n),n.setDate(n.getDate()+1);return a}},S=function(t){if(t=t||o.state,o.aDates=x[t](m),f.min&&(y.min=o.aDates[0]<f.min),f.max){var e=o.aDates[o.aDates.length-1];y.max=e>f.max}},k=function(t,e){return"decade"==o.state?t.getFullYear()<e.getFullYear():"year"==o.state?t.getFullYear()==e.getFullYear()?t.getMonth()<e.getMonth():t.getFullYear()<e.getFullYear():t<e};o.isOff=function(t){return!(!f.min&&!f.max)&&(!(!f.min||!k(t,f.min))||(!(!f.max||!k(f.max,t))||void 0))},o.isActive={year:function(t){return t.getFullYear()==m.getFullYear()},month:function(t){return t.getMonth()==m.getMonth()},date:function(t){return t.getDate()==m.getDate()}},o.isToday=function(t){return o.isActive.date(t)&&o.isActive.month(t)&&o.isActive.year(t)},o.go=function(t){if(!o.isOff(t)){p&&o.state==f.minState&&o.isActive.month(t)&&F(!1);var e=m.getMonth();g(t),o.state==f.minState&&(o.isDefault=!1,p&&r(function(){u.$setViewValue(t),g(t)})),f.toggleState&&o.toggleState(1),e!=m.getMonth()&&S()}},o.now=function(){o.isDefault=!1,g(new Date),S()},o.next=function(t){if(t=t||1,t>0){if(y.max)return}else if(y.min)return;var e=m.getFullYear(),a=m.getMonth(),n=m.getDate();switch(o.state){case"decade":t*=o.aDates.length;case"year":m.setFullYear(e+t,a,15),w(n);break;case"month":m.setMonth(a+t,15),w(n);break;case"week":m.setDate(n+7*t)}S()},o.prev=function(t){return o.next(-t||-1)},o.toggleState=function(t){t=t||1,o.state==f.maxState&&t==-1||o.state==f.minState&&1==t||(o.state=o.aStates[o.aStates.indexOf(o.state)+t],S())},o.mondayStart=f.mondayStart,o.textToday=f.textToday,o.aStates=["decade","year","month"],o.state=f.initState,o.activeDateTpl={decade:"{{aDates[0].getFullYear()}} - {{aDates[aDates.length-1].getFullYear()}}",year:"{{getDate().getFullYear()}}",month:"{{getDate()| date: '"+f.activeMonthFormat.replace("'","")+"'}}",week:"{{getDate() | date: 'd MMMM yyyy' }}"};var $=function(t){t!=m&&(!t||t instanceof Date||(t=new Date(t)),t instanceof Date&&("Invalid Date"==t.toString()||t.isDefault)&&(t=null),t instanceof Date&&((!f.min||f.min<t)&&(!f.max||t<f.max)?(o.isDefault=!1,t.setHours(3,0,1,0),g(t)):o.isDefault||g(d()),p&&(u.$setViewValue(t),u.$viewValue=u.$formatters.reduceRight(function(t,e){return e(t)},t),u.$render())),S())};o.$watch("val",$),$(o.val);var M=function(t){var e=0,a=0;if(t.offsetParent)do e+=t.offsetLeft,a+=t.offsetTop;while(t=t.offsetParent);return{top:a,left:e}},F=function(t){T.css("display",t?"block":"none"),b.css("display",t?"block":"none")},Y=function(t,e){var a=window.scrollX,n=window.scrollY,i=window.innerWidth,r=window.innerHeight;if(window.innerWidth<481)return{top:n,left:0};var o=n+r-t.top-e.clientHeight,s=a+i-t.left-e.clientWidth;return o<0&&(t.top+=o),t.top<n&&(t.top=n),s<0&&(t.left+=s),t.left<0&&(t.left=0),t};if(p){u.$parsers.push(function(t){var e;if(t&&!(t instanceof Date)){var e=new Date(t);a("date")(e,f.format)!=t&&(e=null)}return t instanceof Date&&"Invalid Date"==t.toString()&&(t=null),t instanceof Date?t:m}),u.$formatters.push(function(t){return v()?"":a("date")(t,f.format)}),u.$validators.required=function(){return!c.required||!v()},u.$validators.range=function(){return v()||(!f.min||f.min<m)&&(!f.max||m<f.max)};var T=angular.element('<div class="rm-overlay" style="display:none"></div>');T.on("click",function(){F(!1)}),i.find("body").eq(0).append(T),T.after(e(s)(o));var b=T.next();b.css({display:"none"}),b.addClass("it-is-input"),l.on("click focus",function(){if(!l.prop("readonly")){window.innerWidth<481&&l[0].blur();var t=M(l[0]);t.top+=l[0].offsetHeight+1,b.css({top:t.top+"px",left:t.left+"px",display:"block"}),F(!0),t=Y(t,b[0]),b.css({top:t.top+"px",left:t.left+"px"})}}),i.on("keydown",function(t){[9,13,27].indexOf(t.keyCode)>=0&&F(!1)}),o.$on("$destroy",function(){b.remove(),T.remove()})}else l.append(e(s)(o))},s='<div class="rm-datepicker" ng-class="{mondayStart: mondayStart}"><div class="nav"><a><i class="mi_arrow_back" ng-hide="state == \'decade\'"></i></a><a class="back waves-effect" ng-click="toggleState(-1)" rm-include="activeDateTpl[state]"></a><a class="adjacent waves-effect" ng-click="prev()"><i class="mi_keyboard_arrow_up"></i></a><a class="adjacent waves-effect" ng-click="next()"><i class="mi_keyboard_arrow_down"></i></a><a class="today waves-effect" ng-click="now()">{{textToday}}</a></div><div class="body" ng-include="\'rm-\' + state + \'.html\'"></div></div>';return{require:"ngModel",scope:{val:"=ngModel",rmConfig:"=rmConfig"},link:o}}]),t.run(["$templateCache",function(t){t.put("rm-decade.html",'<div class="ng-class: state; square date"><div ng-repeat="oDate in aDates" ng-class="{j: !isDefault && isActive.year(oDate), off: isOff(oDate)}"><a ng-click="go(oDate)" class="waves-effect"><span>{{oDate | date: \'yyyy\'}}</span></a></div></div>'),t.put("rm-year.html",'<div class="ng-class: state; square date"><div ng-repeat="oDate in aDates" ng-class="{j: !isDefault && isActive.month(oDate), off: isOff(oDate)}"><a ng-click="go(oDate)" class="waves-effect"><span>{{oDate | date: \'LLLL\'}}</span></a></div></div>'),t.put("rm-month.html",'<div class="day sunSat"><a ng-repeat="oDate in aDates | limitTo:7">{{oDate | date: \'EEE\'}}</a></div><div class="ng-class: state; square date"><div ng-repeat="oDate in aDates" ng-class="{j: !isDefault && isActive.date(oDate), off: isOff(oDate), out: !isActive.month(oDate)}"><a ng-click="go(oDate)" class="waves-effect"><span>{{oDate.getDate()}}</span></a></div></div>')}]),t.directive("rmInclude",["$compile",function(t){var e=function(e,a,n){e.$watch(function(t){return t.$eval(n.rmInclude)},function(n){a.html(n),t(a.contents())(e)})};return{restrict:"A",link:e}}])}();