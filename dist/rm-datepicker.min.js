/*!
 * RM-DATEPICKER v1.0.0
 * http://rubymage.com
 *
 * Copyright 2015 Sergiu Ghenciu, RUBYMAGE
 * Released under the MIT license
 * https://github.com/RUBYMAGE/angular-datepicker/blob/master/LICENSE
 */
!function(){var e=angular.module("rmDatepicker",[]),t=(new Date).getTimezoneOffset()/-60;t<0&&(t=0),e.constant("rmDatepickerConfig",{mondayStart:!1,textToday:"Today",initState:"month",maxState:"decade",minState:"month",toggleState:!0,decadeSize:12,monthSize:42,min:null,max:null,"default":new Date,activeMonthFormat:"LLLL yyyy",format:"yyyy-MM-dd"}),e.directive("rmDatepicker",["rmDatepickerConfig","$compile","$filter","$document","$timeout",function(e,a,i,r,o){var s=function(s,c,f,u){var d=angular.copy(e),m=function(){var e=new Date(d["default"].getTime());return e.isDefault=!0,e};s.isDefault=!0;var g=m(),v=function(e){return e.isDefault?s.isDefault=!0:s.val=e,g=e},D=function(){return s.isDefault};s.getDate=function(){return g};var p=function(e){if(e){for(var a in d)d.hasOwnProperty(a)&&void 0!=e[a]&&(d[a]=e[a]);d.min&&d.min.setHours(0,0,0,0),d.max&&d.max.setHours(23,59,59,999),d.min&&d["default"]<d.min&&(d["default"]=new Date(d.min.getTime())),d.max&&d["default"]>d.max&&(d["default"]=new Date(d.max.getTime())),d["default"].setHours(t,0,1,0),D()&&v(m()),y&&(u.$viewValue=g,u.$validate(),u.$invalid&&(s.isDefault=!0,u.$viewValue=v(m()),s.state=d.initState,u.$validate())),k&&k()}};s.$watch("rmConfig",p,!0),p(s.rmConfig);var y="INPUT"==c[0].tagName.toUpperCase(),h={min:!1,max:!1},w=function(e,t){return new Date(e,t+1,0).getDate()},x=function(e){var e=parseInt(e,10);if(!isNaN(g)){var t=w(g.getFullYear(),g.getMonth());e<1&&(e=1),e>t&&(e=t),g.setDate(e)}},S={decade:function(e){var a,i=e.getFullYear(),r=e.getMonth(),o=e.getDate(),s=0,l=d.min?d.min.getFullYear():0;n=d.decadeSize||12;var c=new Array(n);for(i=Math.floor((i-l)/n)*n+l;s<n;i++,s++)a=w(i,r),o>a&&(o=a),c[s]=new Date(i,r,o,t,0,1,0);return c},year:function(e){for(var a,n=e.getFullYear(),i=0,r=e.getDate(),o=[];i<12;i++)a=w(n,i),r>a&&(r=a),o.push(new Date(n,i,r,t,0,1,0));return o},month:function(e){var a,n=e.getFullYear(),i=e.getMonth(),r=new Date(n,i,1,t,0,1,0),o=r.getDay()||7;return s.mondayStart&&(o=o-1||7),a="auto"==d.monthSize?o+w(n,i)<35?35:42:d.monthSize,r.setDate(-o+1),S.dates(r,a)},dates:function(e,t){for(var a=new Array(t),n=new Date(e),i=0;i<t;)a[i++]=new Date(n),n.setDate(n.getDate()+1);return a}},k=function(e){if(e=e||s.state,s.aDates=S[e](g),d.min&&(h.min=s.aDates[0]<d.min),d.max){var t=s.aDates[s.aDates.length-1];h.max=t>d.max}},$=function(e,t){return"decade"==s.state?e.getFullYear()<t.getFullYear():"year"==s.state?e.getFullYear()==t.getFullYear()?e.getMonth()<t.getMonth():e.getFullYear()<t.getFullYear():e<t};s.isOff=function(e){return!(!d.min&&!d.max)&&(!(!d.min||!$(e,d.min))||(!(!d.max||!$(d.max,e))||void 0))},s.isActive={year:function(e){return e.getFullYear()==g.getFullYear()},month:function(e){return e.getMonth()==g.getMonth()},date:function(e){return e.getDate()==g.getDate()}},s.isToday=function(e){return s.isActive.date(e)&&s.isActive.month(e)&&s.isActive.year(e)},s.go=function(e){if(!s.isOff(e)){y&&s.state==d.minState&&s.isActive.month(e)&&Y(!1);var t=g.getMonth();v(e),s.state==d.minState&&(s.isDefault=!1,y&&o(function(){u.$setViewValue(e),v(e)})),d.toggleState&&s.toggleState(1),t!=g.getMonth()&&k()}},s.now=function(){s.isDefault=!1,v(new Date),k()},s.next=function(e){if(e=e||1,e>0){if(h.max)return}else if(h.min)return;var t=g.getFullYear(),a=g.getMonth(),n=g.getDate();switch(s.state){case"decade":e*=s.aDates.length;case"year":g.setFullYear(t+e,a,15),x(n);break;case"month":g.setMonth(a+e,15),x(n);break;case"week":g.setDate(n+7*e)}k()},s.prev=function(e){return s.next(-e||-1)},s.toggleState=function(e){e=e||1,s.state==d.maxState&&e==-1||s.state==d.minState&&1==e||(s.state=s.aStates[s.aStates.indexOf(s.state)+e],k())},s.mondayStart=d.mondayStart,s.textToday=d.textToday,s.aStates=["decade","year","month"],s.state=d.initState,s.activeDateTpl={decade:"{{aDates[0].getFullYear()}} - {{aDates[aDates.length-1].getFullYear()}}",year:"{{getDate().getFullYear()}}",month:"{{getDate()| date: '"+d.activeMonthFormat.replace("'","")+"'}}",week:"{{getDate() | date: 'd MMMM yyyy' }}"};var M=function(e){e!=g&&(!e||e instanceof Date||(e=new Date(e)),e instanceof Date&&("Invalid Date"==e.toString()||e.isDefault)&&(e=null),e instanceof Date&&((!d.min||d.min<e)&&(!d.max||e<d.max)?(s.isDefault=!1,e.setHours(t,0,1,0),v(e)):s.isDefault||v(m()),y&&(u.$setViewValue(e),u.$viewValue=u.$formatters.reduceRight(function(e,t){return t(e)},e),u.$render())),k())},F=function(e){var t=0,a=0;if(e.offsetParent)do t+=e.offsetLeft,a+=e.offsetTop;while(e=e.offsetParent);return{top:a,left:t}},Y=function(e){b.css("display",e?"block":"none"),A.css("display",e?"block":"none")},T=function(e,t){var a=window.scrollX,n=window.scrollY,i=window.innerWidth,r=window.innerHeight;if(window.innerWidth<481)return{top:n,left:0};var o=n+r-e.top-t.clientHeight,s=a+i-e.left-t.clientWidth;return o<0&&(e.top+=o),e.top<n&&(e.top=n),s<0&&(e.left+=s),e.left<0&&(e.left=0),e};if(y){u.$parsers.push(function(e){var t;if(e&&!(e instanceof Date)){var t=new Date(e);i("date")(t,d.format)!=e&&(t=null)}return e instanceof Date&&"Invalid Date"==e.toString()&&(e=null),e instanceof Date?e:g}),u.$formatters.push(function(e){return D()?"":i("date")(e,d.format)}),u.$validators.required=function(){return!f.required||!D()},u.$validators.range=function(){return D()||(!d.min||d.min<g)&&(!d.max||g<d.max)};var b=angular.element('<div class="rm-overlay" style="display:none"></div>');b.on("click",function(){Y(!1)}),r.find("body").eq(0).append(b),b.after(a(l)(s));var A=b.next();A.css({display:"none"}),A.addClass("it-is-input"),c.on("click focus",function(){if(!c.prop("readonly")){window.innerWidth<481&&c[0].blur();var e=F(c[0]);e.top+=c[0].offsetHeight+1,A.css({top:e.top+"px",left:e.left+"px",display:"block"}),Y(!0),e=T(e,A[0]),A.css({top:e.top+"px",left:e.left+"px"})}}),r.on("keydown",function(e){[9,13,27].indexOf(e.keyCode)>=0&&Y(!1)}),s.$on("$destroy",function(){A.remove(),b.remove()})}else c.append(a(l)(s));s.$watch("val",M),M(s.val)},l='<div class="rm-datepicker" ng-class="{mondayStart: mondayStart}"><div class="nav"><a><i class="mi_arrow_back" ng-hide="state == \'decade\'"></i></a><a class="back waves-effect" ng-click="toggleState(-1)" rm-include="activeDateTpl[state]"></a><a class="adjacent waves-effect" ng-click="prev()"><i class="mi_keyboard_arrow_up"></i></a><a class="adjacent waves-effect" ng-click="next()"><i class="mi_keyboard_arrow_down"></i></a><a class="today waves-effect" ng-click="now()">{{textToday}}</a></div><div class="body" ng-include="\'rm-\' + state + \'.html\'"></div></div>';return{require:"ngModel",scope:{val:"=ngModel",rmConfig:"=rmConfig"},link:s}}]),e.run(["$templateCache",function(e){e.put("rm-decade.html",'<div class="ng-class: state; square date"><div ng-repeat="oDate in aDates" ng-class="{j: !isDefault && isActive.year(oDate), off: isOff(oDate)}"><a ng-click="go(oDate)" class="waves-effect"><span>{{oDate | date: \'yyyy\'}}</span></a></div></div>'),e.put("rm-year.html",'<div class="ng-class: state; square date"><div ng-repeat="oDate in aDates" ng-class="{j: !isDefault && isActive.month(oDate), off: isOff(oDate)}"><a ng-click="go(oDate)" class="waves-effect"><span>{{oDate | date: \'LLLL\'}}</span></a></div></div>'),e.put("rm-month.html",'<div class="day sunSat"><a ng-repeat="oDate in aDates | limitTo:7">{{oDate | date: \'EEE\'}}</a></div><div class="ng-class: state; square date"><div ng-repeat="oDate in aDates" ng-class="{j: !isDefault && isActive.date(oDate), off: isOff(oDate), out: !isActive.month(oDate)}"><a ng-click="go(oDate)" class="waves-effect"><span>{{oDate.getDate()}}</span></a></div></div>')}]),e.directive("rmInclude",["$compile",function(e){var t=function(t,a,n){t.$watch(function(e){return e.$eval(n.rmInclude)},function(n){a.html(n),e(a.contents())(t)})};return{restrict:"A",link:t}}])}();