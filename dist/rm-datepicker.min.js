/*!
 * RM-DATEPICKER v1.0.0
 * http://rubymage.com
 *
 * Copyright 2015 Sergiu Ghenciu, RUBYMAGE
 * Released under the MIT license
 * https://github.com/RUBYMAGE/angular-datepicker/blob/master/LICENSE
 */
!function(){var t=angular.module("rmDatepicker",[]);t.constant("rmDatepickerConfig",{mondayStart:!1,textToday:"Today",initState:"month",maxState:"decade",minState:"month",toggleState:!0,decadeSize:12,monthSize:42,min:null,max:null,"default":new Date,activeMonthFormat:"MMMM yyyy",format:"yyyy-MM-dd"}),t.directive("rmDatepicker",["rmDatepickerConfig","$compile","$filter","$document","$timeout",function(t,e,a,i,o){var r=function(r,l,c,f){var u=angular.copy(t),d=function(t){if(t){for(var e in u)u.hasOwnProperty(e)&&void 0!=t[e]&&(u[e]=t[e]);u.min&&u.min.setHours(0,0,0,0),u.max&&u.max.setHours(23,59,59,999),u.min&&u["default"]<u.min&&(u["default"]=new Date(u.min.getTime())),u.max&&u["default"]>u.max&&(u["default"]=new Date(u.max.getTime())),u["default"].setHours(3,0,1,0),r.isDefault&&(r.j=m()),g&&(f.$viewValue=r.j,f.$validate(),f.$invalid&&(r.isDefault=!0,r.j=f.$viewValue=m(),r.state=u.initState,f.$validate())),h&&h()}};r.$watch("rmConfig",d,!0),d(r.rmConfig);var m=function(){return new Date(u["default"].getTime())},g="INPUT"==l[0].tagName.toUpperCase(),v={min:!1,max:!1},D=function(t,e){return new Date(t,e+1,0).getDate()},p=function(t){var t=parseInt(t,10);if(!isNaN(t)){var e=D(r.j.getFullYear(),r.j.getMonth());t<1&&(t=1),t>e&&(t=e),r.j.setDate(t)}},y={decade:function(t){var e,a=t.getFullYear(),i=t.getMonth(),o=t.getDate(),r=0,s=u.min?u.min.getFullYear():0;n=u.decadeSize||12;var l=new Array(n);for(a=Math.floor((a-s)/n)*n+s;r<n;a++,r++)e=D(a,i),o>e&&(o=e),l[r]=new Date(a,i,o,3,0,1,0);return l},year:function(t){for(var e,a=t.getFullYear(),n=0,i=t.getDate(),o=[];n<12;n++)e=D(a,n),i>e&&(i=e),o.push(new Date(a,n,i,3,0,1,0));return o},month:function(t){var e,a=t.getFullYear(),n=t.getMonth(),i=new Date(a,n,1,3,0,1,0),o=i.getDay()||7;return r.mondayStart&&(o=o-1||7),e="auto"==u.monthSize?o+D(a,n)<35?35:42:u.monthSize,i.setDate(-o+1),y.dates(i,e)},dates:function(t,e){for(var a=new Array(e),n=new Date(t),i=0;i<e;)a[i++]=new Date(n),n.setDate(n.getDate()+1);return a}},h=function(t){if(t=t||r.state,r.aDates=y[t](r.j),u.min&&(v.min=r.aDates[0]<u.min),u.max){var e=r.aDates[r.aDates.length-1];v.max=e>u.max}};r.isDefault=!1;var w=function(){if(!(r.j&&r.j instanceof Date)){var t=r.j?new Date(r.j):null;t&&"Invalid Date"!=t.toString()&&(!u.min||u.min<t)&&(!u.max||t<u.max)?(t.setHours(3,0,1,0),r.j=t,r.isDefault=!1):(r.isDefault=!0,r.j=m())}return h()},j=function(t,e){return"decade"==r.state?t.getFullYear()<e.getFullYear():"year"==r.state?t.getFullYear()==e.getFullYear()?t.getMonth()<e.getMonth():t.getFullYear()<e.getFullYear():t<e};r.isOff=function(t){return!(!u.min&&!u.max)&&(!(!u.min||!j(t,u.min))||(!(!u.max||!j(u.max,t))||void 0))},r.isActive={year:function(t){return t.getFullYear()==r.j.getFullYear()},month:function(t){return t.getMonth()==r.j.getMonth()},date:function(t){return t.getDate()==r.j.getDate()}},r.isToday=function(t){return r.isActive.date(t)&&r.isActive.month(t)&&r.isActive.year(t)},r.go=function(t){if(!r.isOff(t)){g&&r.state==u.minState&&r.isActive.month(t)&&S(!1);var e=r.j.getMonth();r.j=new Date(t),r.state==u.minState&&(r.isDefault=!1,o(function(){f.$setViewValue(r.j)})),u.toggleState&&r.toggleState(1),e!=r.j.getMonth()&&h()}},r.now=function(){r.j=new Date,h()},r.next=function(t){if(t=t||1,t>0){if(v.max)return}else if(v.min)return;var e=r.j.getFullYear(),a=r.j.getMonth(),n=r.j.getDate();switch(r.state){case"decade":t*=r.aDates.length;case"year":r.j.setFullYear(e+t,a,15),p(n);break;case"month":r.j.setMonth(a+t,15),p(n);break;case"week":r.j.setDate(n+7*t)}h()},r.prev=function(t){return r.next(-t||-1)},r.toggleState=function(t){t=t||1,r.state==u.maxState&&t==-1||r.state==u.minState&&1==t||(r.state=r.aStates[r.aStates.indexOf(r.state)+t],h())},r.mondayStart=u.mondayStart,r.textToday=u.textToday,r.aStates=["decade","year","month"],r.state=u.initState,r.activeDateTpl={decade:"{{aDates[0].getFullYear()}} - {{aDates[aDates.length-1].getFullYear()}}",year:"{{j.getFullYear()}}",month:"{{j | date: '"+u.activeMonthFormat.replace("'","")+"'}}",week:"{{ j | date: 'd MMMM yyyy' }}"},r.$watch("j",function(t){t&&t instanceof Date||w()}),w();var x=function(t){var e=0,a=0;if(t.offsetParent)do e+=t.offsetLeft,a+=t.offsetTop;while(t=t.offsetParent);return{top:a,left:e}},S=function(t){M.css("display",t?"block":"none"),$.css("display",t?"block":"none")},k=function(t,e){var a=window.scrollX,n=window.scrollY,i=window.innerWidth,o=window.innerHeight;if(window.innerWidth<481)return{top:n,left:0};var r=n+o-t.top-e.clientHeight,s=a+i-t.left-e.clientWidth;return r<0&&(t.top+=r),t.top<n&&(t.top=n),s<0&&(t.left+=s),t.left<0&&(t.left=0),t};if(g){f.$parsers.push(function(t){return t instanceof Date?t:t&&(t=new Date(t))&&"Invalid Date"!=t.toString()?t:m()}),f.$formatters.push(function(t){return r.isDefault?"":a("date")(t,u.format)}),f.$validators.required=function(){return!c.required||!r.isDefault},f.$validators.range=function(){return!r.isDefault&&(!u.min||u.min<r.j)&&(!u.max||r.j<u.max)};var M=angular.element('<div class="rm-overlay" style="display:none"></div>');M.on("click",function(){S(!1)}),i.find("body").eq(0).append(M),M.after(e(s)(r));var $=M.next();$.css({display:"none"}),$.addClass("it-is-input"),l.on("click focus",function(){if(!l.prop("readonly")){window.innerWidth<481&&l[0].blur();var t=x(l[0]);t.top+=l[0].offsetHeight+1,$.css({top:t.top+"px",left:t.left+"px",display:"block"}),S(!0),t=k(t,$[0]),$.css({top:t.top+"px",left:t.left+"px"})}}),i.on("keydown",function(t){[9,13,27].indexOf(t.keyCode)>=0&&S(!1)}),r.$on("$destroy",function(){$.remove(),M.remove()})}else l.append(e(s)(r))},s='<div class="rm-datepicker" ng-class="{mondayStart: mondayStart}"><div class="nav"><a><i class="mi_arrow_back" ng-hide="state == \'decade\'"></i></a><a class="back waves-effect" ng-click="toggleState(-1)" rm-include="activeDateTpl[state]"></a><a class="adjacent waves-effect" ng-click="prev()"><i class="mi_keyboard_arrow_up"></i></a><a class="adjacent waves-effect" ng-click="next()"><i class="mi_keyboard_arrow_down"></i></a><a class="today waves-effect" ng-click="now()">{{textToday}}</a></div><div class="body" ng-include="\'rm-\' + state + \'.html\'"></div></div>';return{require:"ngModel",scope:{j:"=ngModel",rmConfig:"=rmConfig"},link:r}}]),t.run(["$templateCache",function(t){t.put("rm-decade.html",'<div class="ng-class: state; square date"><div ng-repeat="oDate in aDates" ng-class="{j: !isDefault && isActive.year(oDate), off: isOff(oDate)}"><a ng-click="go(oDate)" class="waves-effect"><span>{{oDate | date: \'yyyy\'}}</span></a></div></div>'),t.put("rm-year.html",'<div class="ng-class: state; square date"><div ng-repeat="oDate in aDates" ng-class="{j: !isDefault && isActive.month(oDate), off: isOff(oDate)}"><a ng-click="go(oDate)" class="waves-effect"><span>{{oDate | date: \'MMM\'}}</span></a></div></div>'),t.put("rm-month.html",'<div class="day sunSat"><a ng-repeat="oDate in aDates | limitTo:7">{{oDate | date: \'EEE\'}}</a></div><div class="ng-class: state; square date"><div ng-repeat="oDate in aDates" ng-class="{j: !isDefault && isActive.date(oDate), off: isOff(oDate), out: !isActive.month(oDate)}"><a ng-click="go(oDate)" class="waves-effect"><span>{{oDate.getDate()}}</span></a></div></div>')}]),t.directive("rmInclude",["$compile",function(t){var e=function(e,a,n){e.$watch(function(t){return t.$eval(n.rmInclude)},function(n){a.html(n),t(a.contents())(e)})};return{restrict:"A",link:e}}])}();