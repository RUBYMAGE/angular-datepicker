/*!
 * RM-DATEPICKER v1.0.0
 * http://rubymage.com
 *
 * Copyright 2015 Sergiu Doe, RUBYMAGE
 * Released under the MIT license
 * https://github.com/RUBYMAGE/angular-datepicker/blob/master/LICENSE
 */
!function(){"use strict";var t=angular.module("rmDatepicker",[]);t.constant("rmDatepickerConfig",{mondayStart:!1,initState:"month",maxState:"decade",minState:"month",toggleState:!0,decadeSize:12,monthSize:42,min:null,max:null,format:"yyyy-MM-dd"}),t.directive("rmDatepicker",["rmDatepickerConfig","$compile","$filter","$document",function(t,e,a,n){var i=function(i,o,s,c){var l=angular.copy(t);if(i.rmConfig)for(var f in l)l.hasOwnProperty(f)&&void 0!=i.rmConfig[f]&&(l[f]=i.rmConfig[f]);l.min&&l.min.setHours(0,0,0,0),l.max&&l.max.setHours(23,59,59,999);var d="INPUT"==o[0].tagName.toUpperCase(),u={min:!1,max:!1},g=function(t,e){return new Date(t,e+1,0).getDate()},m=function(t){var t=parseInt(t,10);if(!isNaN(t)){var e=g(i.j.getFullYear(),i.j.getMonth());1>t&&(t=1),t>e&&(t=e),i.j.setDate(t)}},p={decade:function(t){var e,a=t.getFullYear(),n=t.getMonth(),i=t.getDate(),r=0,o=l.decadeSize||12,s=new Array(o);for(a=Math.floor(a/o)*o;o>r;a++,r++)e=g(a,n),i>e&&(i=e),s[r]=new Date(a,n,i,3,0,1,0);return s},year:function(t){for(var e,a=t.getFullYear(),n=0,i=t.getDate(),r=[];12>n;n++)e=g(a,n),i>e&&(i=e),r.push(new Date(a,n,i,3,0,1,0));return r},month:function(t){var e,a=t.getFullYear(),n=t.getMonth(),r=new Date(a,n,1,3,0,1,0),o=r.getDay()||7;return i.mondayStart&&(o=o-1||7),e="auto"==l.monthSize?o+g(a,n)<35?35:42:l.monthSize,r.setDate(-o+1),p.dates(r,e)},dates:function(t,e){for(var a=new Array(e),n=new Date(t),i=0;e>i;)a[i++]=new Date(n),n.setDate(n.getDate()+1);return a}},v=function(t){if(t=t||i.state,i.aDates=p[t](i.j),l.min&&(u.min=i.aDates[0]<l.min),l.max){var e=i.aDates[i.aDates.length-1];u.max=e>l.max}},y=function(){return v()},h=function(t,e){return"decade"==i.state?t.getFullYear()<e.getFullYear():"year"==i.state?t.getFullYear()==e.getFullYear()?t.getMonth()<e.getMonth():t.getFullYear()<e.getFullYear():e>t};i.isOff=function(t){return l.min||l.max?l.min&&h(t,l.min)?!0:l.max&&h(l.max,t)?!0:void 0:!1},i.isActive={year:function(t){return t.getFullYear()==i.j.getFullYear()},month:function(t){return t.getMonth()==i.j.getMonth()},date:function(t){return t.getDate()==i.j.getDate()}},i.isToday=function(t){return i.isActive.date(t)&&i.isActive.month(t)&&i.isActive.year(t)},i.go=function(t){if(!i.isOff(t)){d&&i.state==l.minState&&i.isActive.month(t)&&(i.show=!1,M.css("display","none"));var e=i.j.getMonth();i.j=new Date(t),l.toggleState&&i.toggleState(1),e!=i.j.getMonth()&&v()}},i.now=function(){i.j=new Date,v()},i.next=function(t){if(t=t||1,t>0){if(u.max)return}else if(u.min)return;var e=i.j.getFullYear(),a=i.j.getMonth(),n=i.j.getDate();switch(i.state){case"decade":t*=i.aDates.length;case"year":i.j.setFullYear(e+t,a,15),m(n);break;case"month":i.j.setMonth(a+t,15),m(n);break;case"week":i.j.setDate(n+7*t)}v()},i.prev=function(t){return i.next(-t||-1)},i.toggleState=function(t){t=t||1,i.state==l.maxState&&-1==t||i.state==l.minState&&1==t||(i.state=i.aStates[i.aStates.indexOf(i.state)+t],v())},i.mondayStart=l.mondayStart,i.aWeekDay=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],i.mondayStart&&i.aWeekDay.push(i.aWeekDay.shift()),i.aStates=["decade","year","month"],i.state=l.initState,i.activeDateTpl={decade:"{{aDates[0].getFullYear()}} - {{aDates[aDates.length-1].getFullYear()}}",year:"{{j.getFullYear()}}",month:"{{j | date: 'MMMM yyyy'}}",week:"{{ j | date: 'd MMMM yyyy' }}"},y();var D=function(t){var e=0,a=0;if(t.offsetParent)do e+=t.offsetLeft,a+=t.offsetTop;while(t=t.offsetParent);return{top:a,left:e}},w=function(t){M.css("display",t?"block":"none"),i.show=t,i.$apply()},k=function(t){var e=window.scrollX,a=window.scrollY,n=window.innerWidth,i=window.innerHeight;if(window.innerWidth<481)return{top:a,left:0};var r=D(t),o=a+i-r.top-t.clientHeight,s=e+n-r.left-t.clientWidth;return 0>o&&(r.top+=o),r.top<a&&(r.top=a),0>s&&(r.left+=s),r.left<0&&(r.left=0),r};if(d){i.show=!1,c.$parsers.push(function(t){return new Date(t)}),c.$formatters.push(function(t){return a("date")(t,l.format)}),o.after(e(r)(i));var S=o.next(),M=angular.element('<div class="rm-overlay" style="display:none"></div>');M.on("click",function(){w(!1)}),n.find("body").eq(0).append(M),o.on("click",function(){window.innerWidth<481&&o[0].blur();var t=D(o[0]);t.top+=o[0].offsetHeight+1,i.style={top:t.top+"px",left:t.left+"px"},w(!0),t=k(S[0]),i.style={top:t.top+"px",left:t.left+"px"},i.$apply()}),n.on("keydown",function(t){[9,13,27].indexOf(t.keyCode)>=0&&w(!1)})}else i.show=!0,o.append(e(r)(i))},r='<div class="rm-datepicker" ng-class="{mondayStart: mondayStart}" ng-show="show" ng-style="style"><div class="nav"><a><i class="mi_arrow_back"></i></a><a class="back waves-effect" ng-click="toggleState(-1)" rm-include="activeDateTpl[state]"></a><a class="adjacent waves-effect" ng-click="prev()"><i class="mi_keyboard_arrow_up"></i></a><a class="adjacent waves-effect" ng-click="next()"><i class="mi_keyboard_arrow_down"></i></a><a class="today waves-effect" ng-click="now()">Today</a></div><div class="body" ng-include="\'rm-\' + state + \'.html\'"></div></div><script type="text/ng-template" id="rm-decade.html"><div class="ng-class: state; square date"><div ng-repeat="oDate in aDates" ng-class="{j: isActive[\'year\'](oDate), off: isOff(oDate)}"><a ng-click="go(oDate)" class="waves-effect"><span>{{oDate | date: \'yyyy\'}}</span></a></div></div></script><script type="text/ng-template" id="rm-year.html"><div class="ng-class: state; square date"><div ng-repeat="oDate in aDates" ng-class="{j: isActive[\'month\'](oDate), off: isOff(oDate)}"><a ng-click="go(oDate)" class="waves-effect"><span>{{oDate | date: \'MMM\'}}</span></a></div></div></script><script type="text/ng-template" id="rm-month.html"><div class="day sunSat" ng-if="state == \'month\'"><a ng-repeat="day in aWeekDay">{{day}}</a></div><div class="ng-class: state; square date"><div ng-repeat="oDate in aDates" ng-class="{j: isActive[\'date\'](oDate), off: isOff(oDate), out: !isActive[\'month\'](oDate)}"><a ng-click="go(oDate)" class="waves-effect"><span>{{oDate.getDate()}}</span></a></div></div></script>';return{require:"ngModel",scope:{j:"=ngModel",rmConfig:"="},link:i}}]),t.directive("rmInclude",["$compile",function(t){var e=function(e,a,n){e.$watch(function(t){return t.$eval(n.rmInclude)},function(n){a.html(n),t(a.contents())(e)})};return{restrict:"A",link:e}}])}();