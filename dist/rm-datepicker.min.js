/*!
 * RM-DATEPICKER v1.0.0
 * http://rubymage.com
 *
 * Copyright 2015 Sergiu Ghenciu, RUBYMAGE
 * Released under the MIT license
 * https://github.com/RUBYMAGE/angular-datepicker/blob/master/LICENSE
 */
!function(){"use strict";var t=angular.module("rmDatepicker",[]);t.constant("rmDatepickerConfig",{mondayStart:!1,textToday:"Today",initState:"month",maxState:"decade",minState:"month",toggleState:!0,decadeSize:12,monthSize:42,min:null,max:null,format:"yyyy-MM-dd"}),t.directive("rmDatepicker",["rmDatepickerConfig","$compile","$filter","$document","$timeout",function(t,e,a,n,i){var o=function(o,s,l,c){function d(t){setTimeout(function(){var e=t.children()[1];e&&(e.addEventListener?"onwheel"in document?e.addEventListener("wheel",f,!1):"onmousewheel"in document||e.addEventListener("MozMousePixelScroll",f,!1):e.attachEvent&&e.attachEvent("onmousewheel",f))},700)}function f(t){var e=t||t.originalEvent;e.preventDefault(),e.stopPropagation(),T||C(e),T=!0}function u(t){T&&(t.wheelDelta/120>0?o.prev():o.next()),T=!1}function g(t,e,a){var n,o,r,s=void 0,l=0;a||(a={});var c=function(){l=a.leading===!1?0:Date.now(),s&&i.cancel(s),s=void 0,r=t.apply(n,o),s||(n=o=void 0)};return function(){var d=Date.now();l||a.leading!==!1||(l=d);var f=e-(d-l);return n=this,o=arguments,f<=0||f>e?(s&&i.cancel(s),s=void 0,l=d,r=t.apply(n,o),s||(n=o=void 0)):s||a.trailing===!1||(s=i(c,f)),r}}var v=angular.copy(t);if(o.rmConfig)for(var m in v)v.hasOwnProperty(m)&&void 0!=o.rmConfig[m]&&(v[m]=o.rmConfig[m]);v.min&&v.min.setHours(0,0,0,0),v.max&&v.max.setHours(23,59,59,999);var p="INPUT"==s[0].tagName.toUpperCase(),D={min:!1,max:!1},h=function(t,e){return new Date(t,e+1,0).getDate()},y=function(t){var t=parseInt(t,10);if(!isNaN(t)){var e=h(o.j.getFullYear(),o.j.getMonth());t<1&&(t=1),t>e&&(t=e),o.j.setDate(t)}},w={decade:function(t){var e,a=t.getFullYear(),n=t.getMonth(),i=t.getDate(),o=0,r=v.decadeSize||12,s=new Array(r);for(a=Math.floor(a/r)*r;o<r;a++,o++)e=h(a,n),i>e&&(i=e),s[o]=new Date(a,n,i,3,0,1,0);return s},year:function(t){for(var e,a=t.getFullYear(),n=0,i=t.getDate(),o=[];n<12;n++)e=h(a,n),i>e&&(i=e),o.push(new Date(a,n,i,3,0,1,0));return o},month:function(t){var e,a=t.getFullYear(),n=t.getMonth(),i=new Date(a,n,1,3,0,1,0),r=i.getDay()||7;return o.mondayStart&&(r=r-1||7),e="auto"==v.monthSize?r+h(a,n)<35?35:42:v.monthSize,i.setDate(-r+1),w.dates(i,e)},dates:function(t,e){for(var a=new Array(e),n=new Date(t),i=0;i<e;)a[i++]=new Date(n),n.setDate(n.getDate()+1);return a}},S=function(t){t=t||o.state,o.aDates=w[t](o.j);var e=new Date(o.rmConfig.min);e&&"Invalid Date"!==e.toString()||(e=v.min),e&&(D.min=o.aDates[0]<e);var a=new Date(o.rmConfig.max);if(a&&"Invalid Date"!==a.toString()||(a=v.max),a){var n=o.aDates[o.aDates.length-1];D.max=n>a}},x=function(){return S()},j=function(t,e){return"decade"==o.state?t.getFullYear()<e.getFullYear():"year"==o.state?t.getFullYear()==e.getFullYear()?t.getMonth()<e.getMonth():t.getFullYear()<e.getFullYear():t<e};o.isOff=function(t){var e=new Date(o.rmConfig.min);e&&"Invalid Date"!==e.toString()||(e=v.min);var a=new Date(o.rmConfig.max);return a&&"Invalid Date"!==a.toString()||(a=v.max),!(!e&&!a)&&(!(!e||!j(t,e))||(!(!a||!j(a,t))||void 0))},o.isActive={year:function(t){return t.getFullYear()==o.j.getFullYear()},month:function(t){return t.getMonth()==o.j.getMonth()},date:function(t){return t.getDate()==o.j.getDate()}},o.isToday=function(t){return o.isActive.date(t)&&o.isActive.month(t)&&o.isActive.year(t)},o.go=function(t){if(!o.isOff(t)){p&&o.state==v.minState&&o.isActive.month(t)&&(o.show=!1,A.css("display","none"));var e=o.j.getMonth();o.j=new Date(t),i(function(){c.$setViewValue(o.j)}),v.toggleState&&o.toggleState(1),e!=o.j.getMonth()&&S()}},o.now=function(){o.j=new Date,S()},o.next=function(t){if(t=t||1,t>0){if(D.max)return}else if(D.min)return;var e=o.j.getFullYear(),a=o.j.getMonth(),n=o.j.getDate();switch(o.state){case"decade":t*=o.aDates.length;case"year":o.j.setFullYear(e+t,a,15),y(n);break;case"month":o.j.setMonth(a+t,15),y(n);break;case"week":o.j.setDate(n+7*t)}S()},o.prev=function(t){return o.next(-t||-1)},o.toggleState=function(t){t=t||1,o.state==v.maxState&&t==-1||o.state==v.minState&&1==t||(o.state=o.aStates[o.aStates.indexOf(o.state)+t],S())},o.mondayStart=v.mondayStart,o.textToday=v.textToday,o.aStates=["decade","year","month"],o.state=v.initState,o.activeDateTpl={decade:"{{aDates[0].getFullYear()}} - {{aDates[aDates.length-1].getFullYear()}}",year:"{{j.getFullYear()}}",month:"{{j | date: 'MMMM yyyy'}}",week:"{{ j | date: 'd MMMM yyyy' }}"},x();var M=function(t){var e=0,a=0;if(t.offsetParent)do e+=t.offsetLeft,a+=t.offsetTop;while(t=t.offsetParent);return{top:a,left:e}},k=function(t){A.css("display",t?"block":"none"),o.show=t,o.show&&d(s.next()),o.$apply()},Y=function(t){var e=window.scrollX,a=window.scrollY,n=window.innerWidth,i=window.innerHeight;if(window.innerWidth<481)return{top:a,left:0};var o=M(t),r=a+i-o.top-t.clientHeight,s=e+n-o.left-t.clientWidth;return r<0&&(o.top+=r),o.top<a&&(o.top=a),s<0&&(o.left+=s),o.left<0&&(o.left=0),o};if(p){o.show=!1,c.$parsers.push(function(t){return new Date(t)}),c.$formatters.push(function(t){return a("date")(t,v.format)}),s.after(e(r)(o));var F=s.next(),A=angular.element('<div class="rm-overlay" style="display:none"></div>');A.on("click",function(){k(!1)}),n.find("body").eq(0).append(A),s.on("click",function(){s[0].blur(),o.j="Invalid Date"===o.j.toString()?new Date:o.j;var t=M(s[0]);t.top+=s[0].offsetHeight+1,o.style={top:t.top+"px",left:t.left+"px"},k(!0),t=Y(F[0]),o.style={top:t.top+"px",left:t.left+"px"},o.$apply()}),n.on("keydown",function(t){[9,13,27].indexOf(t.keyCode)>=0&&k(!1)})}else o.show=!0,s.append(e(r)(o)),d(angular.element(s.children()[0]));var C=g(u,150,{leading:!1,trailing:!0}),T=!1},r='<div class="rm-datepicker" ng-class="{mondayStart: mondayStart}" ng-show="show" ng-style="style"><div class="nav"><a><i class="mi_arrow_back"></i></a><a class="back waves-effect" ng-click="toggleState(-1)" rm-include="activeDateTpl[state]"></a><a class="adjacent waves-effect" ng-click="prev()"><i class="mi_keyboard_arrow_up"></i></a><a class="adjacent waves-effect" ng-click="next()"><i class="mi_keyboard_arrow_down"></i></a><a class="today waves-effect" ng-click="now()">{{textToday}}</a></div><div class="body" ng-include="\'rm-\' + state + \'.html\'"></div></div><script type="text/ng-template" id="rm-decade.html"><div class="ng-class: state; square date"><div ng-repeat="oDate in aDates" ng-class="{j: isActive[\'year\'](oDate), off: isOff(oDate)}"><a ng-click="go(oDate)" class="waves-effect"><span>{{oDate | date: \'yyyy\'}}</span></a></div></div></script><script type="text/ng-template" id="rm-year.html"><div class="ng-class: state; square date"><div ng-repeat="oDate in aDates" ng-class="{j: isActive[\'month\'](oDate), off: isOff(oDate)}"><a ng-click="go(oDate)" class="waves-effect"><span>{{oDate | date: \'MMM\'}}</span></a></div></div></script><script type="text/ng-template" id="rm-month.html"><div class="day sunSat" ng-if="state == \'month\'"><a ng-repeat="oDate in aDates | limitTo:7">{{oDate | date: \'EEE\'}}</a></div><div class="ng-class: state; square date"><div ng-repeat="oDate in aDates" ng-class="{j: isActive[\'date\'](oDate), off: isOff(oDate), out: !isActive[\'month\'](oDate)}"><a ng-click="go(oDate)" class="waves-effect"><span>{{oDate.getDate()}}</span></a></div></div></script>';return{require:"ngModel",scope:{j:"=ngModel",rmConfig:"="},link:o}}]),t.directive("rmInclude",["$compile",function(t){var e=function(e,a,n){e.$watch(function(t){return t.$eval(n.rmInclude)},function(n){a.html(n),t(a.contents())(e)})};return{restrict:"A",link:e}}])}();