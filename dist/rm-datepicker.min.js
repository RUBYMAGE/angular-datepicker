/*!
 * RM-DATEPICKER v1.0.0
 * http://rubymage.com
 *
 * Copyright 2015 Sergiu Ghenciu, RUBYMAGE
 * Released under the MIT license
 * https://github.com/RUBYMAGE/angular-datepicker/blob/master/LICENSE
 */
!function(){"use strict";var e=angular.module("rmDatepicker",[]);e.constant("rmDatepickerConfig",{mondayStart:!1,textToday:"Today",initState:"month",maxState:"decade",minState:"month",toggleState:!0,decadeSize:12,monthSize:42,min:null,max:null,format:"yyyy-MM-dd"}),e.directive("rmDatepicker",["rmDatepickerConfig","$compile","$filter","$document","$timeout",function(e,t,a,n,i){var o=function(o,s,l,c){function d(e){setTimeout(function(){var t=e.children()[1];t&&(t.addEventListener?"onwheel"in document?t.addEventListener("wheel",f,!1):"onmousewheel"in document||t.addEventListener("MozMousePixelScroll",f,!1):t.attachEvent&&t.attachEvent("onmousewheel",f))},700)}function f(e){var t=e||e.originalEvent;t.preventDefault(),t.stopPropagation(),T||C(t),T=!0}function u(e){T&&(e.wheelDelta/120>0?o.prev():o.next()),T=!1}function g(e,t,a){var n,o,r,s=void 0,l=0;a||(a={});var c=function(){l=a.leading===!1?0:Date.now(),s&&i.cancel(s),s=void 0,r=e.apply(n,o),s||(n=o=void 0)};return function(){var d=Date.now();l||a.leading!==!1||(l=d);var f=t-(d-l);return n=this,o=arguments,f<=0||f>t?(s&&i.cancel(s),s=void 0,l=d,r=e.apply(n,o),s||(n=o=void 0)):s||a.trailing===!1||(s=i(c,f)),r}}var v=angular.copy(e);if(o.rmConfig)for(var m in v)v.hasOwnProperty(m)&&void 0!=o.rmConfig[m]&&(v[m]=o.rmConfig[m]);v.min&&v.min.setHours(0,0,0,0),v.max&&v.max.setHours(23,59,59,999);var D="INPUT"==s[0].tagName.toUpperCase(),w={min:!1,max:!1},p=function(e,t){return new Date(e,t+1,0).getDate()},h=function(e){var e=parseInt(e,10);if(!isNaN(e)){var t=p((o.j||new Date).getFullYear(),(o.j||new Date).getMonth());e<1&&(e=1),e>t&&(e=t),o.j.setDate(e)}},y={decade:function(e){var t,a=(e||new Date).getFullYear(),n=(e||new Date).getMonth(),i=(e||new Date).getDate(),o=0,r=v.decadeSize||12,s=new Array(r);for(a=Math.floor(a/r)*r;o<r;a++,o++)t=p(a,n),i>t&&(i=t),s[o]=new Date(a,n,i,3,0,1,0);return s},year:function(e){for(var t,a=(e||new Date).getFullYear(),n=0,i=(e||new Date).getDate(),o=[];n<12;n++)t=p(a,n),i>t&&(i=t),o.push(new Date(a,n,i,3,0,1,0));return o},month:function(e){var t,a=(e||new Date).getFullYear(),n=(e||new Date).getMonth(),i=new Date(a,n,1,3,0,1,0),r=i.getDay()||7;return o.mondayStart&&(r=r-1||7),t="auto"==v.monthSize?r+p(a,n)<35?35:42:v.monthSize,i.setDate(-r+1),y.dates(i,t)},dates:function(e,t){for(var a=new Array(t),n=new Date(e),i=0;i<t;)a[i++]=new Date(n),n.setDate(n.getDate()+1);return a}},S=function(e){e=e||o.state,o.aDates=y[e](o.j||new Date);var t=new Date(o.rmConfig.min);t&&"Invalid Date"!==t.toString()||(t=v.min),t&&(w.min=o.aDates[0]<t);var a=new Date(o.rmConfig.max);if(a&&"Invalid Date"!==a.toString()||(a=v.max),a){var n=o.aDates[o.aDates.length-1];w.max=n>a}},x=function(){return S()},j=function(e,t){return"decade"==o.state?e.getFullYear()<t.getFullYear():"year"==o.state?e.getFullYear()==t.getFullYear()?e.getMonth()<t.getMonth():e.getFullYear()<t.getFullYear():e<t};o.isOff=function(e){var t=new Date(o.rmConfig.min);t&&"Invalid Date"!==t.toString()||(t=v.min);var a=new Date(o.rmConfig.max);return a&&"Invalid Date"!==a.toString()||(a=v.max),!(!t&&!a)&&(!(!t||!j(e,t))||(!(!a||!j(a,e))||void 0))},o.isActive={year:function(e){return(e||new Date).getFullYear()==(o.j||new Date).getFullYear()},month:function(e){return(e||new Date).getMonth()==(o.j||new Date).getMonth()},date:function(e){return(e||new Date).getDate()==(o.j||new Date).getDate()}},o.isToday=function(e){return o.isActive.date(e)&&o.isActive.month(e)&&o.isActive.year(e)},o.go=function(e){if(!o.isOff(e)){D&&o.state==v.minState&&o.isActive.month(e)&&(o.show=!1,A.css("display","none"));var t=(o.j||new Date).getMonth();o.j=new Date(e),i(function(){c.$setViewValue(o.j||new Date)}),v.toggleState&&o.toggleState(1),t!=(o.j||new Date).getMonth()&&S()}},o.now=function(){o.j=new Date,S()},o.next=function(e){if(e=e||1,e>0){if(w.max)return}else if(w.min)return;var t=(o.j||new Date).getFullYear(),a=(o.j||new Date).getMonth(),n=(o.j||new Date).getDate();switch(o.state){case"decade":e*=o.aDates.length;case"year":o.j.setFullYear(t+e,a,15),h(n);break;case"month":o.j.setMonth(a+e,15),h(n);break;case"week":o.j.setDate(n+7*e)}S()},o.prev=function(e){return o.next(-e||-1)},o.toggleState=function(e){e=e||1,o.state==v.maxState&&e==-1||o.state==v.minState&&1==e||(o.state=o.aStates[o.aStates.indexOf(o.state)+e],S())},o.mondayStart=v.mondayStart,o.textToday=v.textToday,o.aStates=["decade","year","month"],o.state=v.initState,o.activeDateTpl={decade:"{{aDates[0].getFullYear()}} - {{aDates[aDates.length-1].getFullYear()}}",year:"{{j.getFullYear()}}",month:"{{j | date: 'MMMM yyyy'}}",week:"{{ j | date: 'd MMMM yyyy' }}"},x();var M=function(e){var t=0,a=0;if(e.offsetParent)do t+=e.offsetLeft,a+=e.offsetTop;while(e=e.offsetParent);return{top:a,left:t}},k=function(e){A.css("display",e?"block":"none"),o.show=e,o.show&&d(s.next()),o.$apply()},Y=function(e){var t=window.scrollX,a=window.scrollY,n=window.innerWidth,i=window.innerHeight;if(window.innerWidth<481)return{top:a,left:0};var o=M(e),r=a+i-o.top-e.clientHeight,s=t+n-o.left-e.clientWidth;return r<0&&(o.top+=r),o.top<a&&(o.top=a),s<0&&(o.left+=s),o.left<0&&(o.left=0),o};if(D){o.show=!1,c.$parsers.push(function(e){return new Date(e)}),c.$formatters.push(function(e){return a("date")(e,v.format)}),s.after(t(r)(o));var F=s.next(),A=angular.element('<div class="rm-overlay" style="display:none"></div>');A.on("click",function(){k(!1)}),n.find("body").eq(0).append(A),s.on("click",function(){s[0].blur(),o.j="Invalid Date"===o.j.toString()?new Date:o.j;var e=M(s[0]);e.top+=s[0].offsetHeight+1,o.style={top:e.top+"px",left:e.left+"px"},k(!0),e=Y(F[0]),o.style={top:e.top+"px",left:e.left+"px"},o.$apply()}),n.on("keydown",function(e){[9,13,27].indexOf(e.keyCode)>=0&&k(!1)})}else o.show=!0,s.append(t(r)(o)),d(angular.element(s.children()[0]));var C=g(u,150,{leading:!1,trailing:!0}),T=!1},r='<div class="rm-datepicker" ng-class="{mondayStart: mondayStart}" ng-show="show" ng-style="style"><div class="nav"><a><i class="mi_arrow_back"></i></a><a class="back waves-effect" ng-click="toggleState(-1)" rm-include="activeDateTpl[state]"></a><a class="adjacent waves-effect" ng-click="prev()"><i class="mi_keyboard_arrow_up"></i></a><a class="adjacent waves-effect" ng-click="next()"><i class="mi_keyboard_arrow_down"></i></a><a class="today waves-effect" ng-click="now()">{{textToday}}</a></div><div class="body" ng-include="\'rm-\' + state + \'.html\'"></div></div><script type="text/ng-template" id="rm-decade.html"><div class="ng-class: state; square date"><div ng-repeat="oDate in aDates" ng-class="{j: isActive[\'year\'](oDate), off: isOff(oDate)}"><a ng-click="go(oDate)" class="waves-effect"><span>{{oDate | date: \'yyyy\'}}</span></a></div></div></script><script type="text/ng-template" id="rm-year.html"><div class="ng-class: state; square date"><div ng-repeat="oDate in aDates" ng-class="{j: isActive[\'month\'](oDate), off: isOff(oDate)}"><a ng-click="go(oDate)" class="waves-effect"><span>{{oDate | date: \'MMM\'}}</span></a></div></div></script><script type="text/ng-template" id="rm-month.html"><div class="day sunSat" ng-if="state == \'month\'"><a ng-repeat="oDate in aDates | limitTo:7">{{oDate | date: \'EEE\'}}</a></div><div class="ng-class: state; square date"><div ng-repeat="oDate in aDates" ng-class="{j: isActive[\'date\'](oDate), off: isOff(oDate), out: !isActive[\'month\'](oDate)}"><a ng-click="go(oDate)" class="waves-effect"><span>{{oDate.getDate()}}</span></a></div></div></script>';return{require:"ngModel",scope:{j:"=ngModel",rmConfig:"="},link:o}}]),e.directive("rmInclude",["$compile",function(e){var t=function(t,a,n){t.$watch(function(e){return e.$eval(n.rmInclude)},function(n){a.html(n),e(a.contents())(t)})};return{restrict:"A",link:t}}])}();